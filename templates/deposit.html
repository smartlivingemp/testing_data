<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Deposit Funds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-5">
    {% include 'customer_sidebar.html' %}

  <h3 class="mb-4 text-center">Deposit Funds</h3>

  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card p-4 shadow-sm">
        <label class="form-label fw-semibold">Enter Amount (GHS)</label>
        <input type="number" id="amount" class="form-control mb-3" placeholder="e.g. 50" />

        <button class="btn btn-primary w-100" onclick="payWithPaystack()">Pay Now</button>
      </div>
    </div>
  </div>


  <script>
    function payWithPaystack() {
      const amount = parseFloat(document.getElementById("amount").value);
      const email = "{{ email | default('') }}";

      if (!email || email === "None") {
        alert("‚ùå Your email is not set. Please log in again.");
        return;
      }

      if (!amount || amount < 1) {
        alert("‚ùå Enter a valid amount (GHS 1 or more)");
        return;
      }

      const kobo = amount * 100;

      console.log("üì¶ Paystack Setup:", {
        key: 'pk_test_4d797b8956a3d22eb73f1c55fe72fc10d3e0f979',
        email: email,
        amount_kobo: kobo
      });

      const handler = PaystackPop.setup({
        key: 'pk_test_4d797b8956a3d22eb73f1c55fe72fc10d3e0f979',
        email: email,
        amount: kobo,
        currency: "GHS",
        callback: function(response) {
          console.log("‚úîÔ∏è Paystack Reference:", response.reference);
          window.location.href = `/verify_transaction?reference=${response.reference}&amount=${amount}`;
        },
        onClose: function() {
          alert("Transaction cancelled");
        }
      });

      handler.openIframe();
    }
  </script>

</body>
</html>
