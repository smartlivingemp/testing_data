<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    .is-valid { border-color: #198754 !important; }
    .is-invalid { border-color: #dc3545 !important; }
    .password-check { font-size: 0.9rem; }
    #passwordSection { display: none; }
  </style>
</head>
<body>
  {% include 'customer_sidebar.html' %}

  <div class="content-with-sidebar p-4">
    <div class="container">
      <h3 class="mb-4">
        <i class="bi bi-person-circle me-2 text-primary"></i>My Profile
      </h3>

      <div class="row g-4">
        <!-- Profile Info -->
        <div class="col-lg-6">
          <div class="card border-0 shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-3"><i class="bi bi-person-lines-fill text-primary me-1"></i> Profile Details</h5>
              <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>First Name:</strong> {{ customer.first_name }}</li>
                <li class="list-group-item"><strong>Last Name:</strong> {{ customer.last_name }}</li>
                <li class="list-group-item"><strong>Username:</strong> {{ customer.username }}</li>
                <li class="list-group-item"><strong>Email:</strong> {{ customer.email or 'N/A' }}</li>
                <li class="list-group-item"><strong>Phone:</strong> {{ customer.phone }}</li>
                <li class="list-group-item"><strong>WhatsApp:</strong> {{ customer.whatsapp }}</li>
                <li class="list-group-item"><strong>Business Name:</strong> {{ customer.business_name }}</li>
                <li class="list-group-item"><strong>Referral:</strong> {{ customer.referral or 'N/A' }}</li>
                <li class="list-group-item">
                  <strong>Status:</strong>
                  {% if customer.status == "active" %}
                    <span class="badge bg-success">Active</span>
                  {% else %}
                    <span class="badge bg-secondary">{{ customer.status|capitalize }}</span>
                  {% endif %}
                </li>
                <li class="list-group-item">
                  <strong>Registered On:</strong>
                  {{ customer.created_at.strftime('%d %b %Y, %I:%M %p') }}
                </li>
              </ul>
              <div class="text-end mt-3">
                <button class="btn btn-outline-primary" onclick="togglePasswordForm()">
                  <i class="bi bi-lock-fill me-1"></i> Change Password
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Password Change Form -->
        <div class="col-lg-6">
          <div class="card border-0 shadow-sm" id="passwordSection">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-shield-lock-fill text-danger me-1"></i> Change Password</h5>
              <form method="POST" id="passwordForm">
                <div class="mb-3">
                  <label class="form-label">Current Password</label>
                  <input type="password" name="current_password" class="form-control" id="current_password" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">New Password</label>
                  <input type="password" name="new_password" class="form-control" id="new_password" required>
                  <div class="password-check text-danger mt-1" id="strength_msg">Must be at least 8 characters and include letters & numbers.</div>
                </div>
                <div class="mb-3">
                  <label class="form-label">Confirm New Password</label>
                  <input type="password" name="confirm_password" class="form-control" id="confirm_password" required>
                  <div class="password-check text-danger mt-1" id="match_msg">Passwords must match.</div>
                </div>
                <div class="text-end">
                  <button type="submit" class="btn btn-primary">
                    <i class="bi bi-arrow-repeat me-1"></i> Update Password
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
  {% include 'customer_footer.html' %}

  <script>
    function togglePasswordForm() {
      const section = document.getElementById("passwordSection");
      section.style.display = section.style.display === "none" ? "block" : "none";
    }

    const newPass = document.getElementById("new_password");
    const confirmPass = document.getElementById("confirm_password");
    const strengthMsg = document.getElementById("strength_msg");
    const matchMsg = document.getElementById("match_msg");

    function validateStrength() {
      const value = newPass.value;
      const isStrong = value.length >= 8 && /\d/.test(value) && /[a-zA-Z]/.test(value);

      if (isStrong) {
        newPass.classList.add("is-valid");
        newPass.classList.remove("is-invalid");
        strengthMsg.classList.remove("text-danger");
        strengthMsg.classList.add("text-success");
        strengthMsg.textContent = "Password strength is good.";
      } else {
        newPass.classList.add("is-invalid");
        newPass.classList.remove("is-valid");
        strengthMsg.classList.remove("text-success");
        strengthMsg.classList.add("text-danger");
        strengthMsg.textContent = "Must be at least 8 characters and include letters & numbers.";
      }

      validateMatch();
    }

    function validateMatch() {
      if (
        confirmPass.value &&
        confirmPass.value === newPass.value &&
        newPass.classList.contains("is-valid")
      ) {
        confirmPass.classList.add("is-valid");
        confirmPass.classList.remove("is-invalid");
        matchMsg.classList.remove("text-danger");
        matchMsg.classList.add("text-success");
        matchMsg.textContent = "Passwords match.";
      } else {
        confirmPass.classList.add("is-invalid");
        confirmPass.classList.remove("is-valid");
        matchMsg.classList.remove("text-success");
        matchMsg.classList.add("text-danger");
        matchMsg.textContent = "Passwords must match.";
      }
    }

    newPass.addEventListener("input", validateStrength);
    confirmPass.addEventListener("input", validateMatch);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
